<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico - Bot√µes Editar</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 10px; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        .log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            font-family: monospace; 
            font-size: 12px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>Diagn√≥stico - Bot√µes Editar</h1>
    
    <h3>Testes Diagn√≥sticos:</h3>
    <button class="btn btn-warning" onclick="testarEditarImovel()">Testar editarImovel(1)</button>
    <button class="btn btn-warning" onclick="testarEditarImovelModal()">Testar editarImovelModal()</button>
    <button class="btn btn-danger" onclick="verificarFormulario()">Verificar Formul√°rio</button>
    <button class="btn btn-danger" onclick="verificarElementos()">Verificar Elementos DOM</button>
    
    <div id="resultado"></div>

    <script src="script.js?v=20250709"></script>
    <script>
        function log(msg, type = 'info') {
            const div = document.getElementById('resultado');
            const logDiv = document.createElement('div');
            logDiv.className = 'log ' + (type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '');
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${msg}`;
            div.appendChild(logDiv);
            console.log(msg);
        }

        function testarEditarImovel() {
            log('=== TESTANDO editarImovel(1) ===');
            
            if (!window.sistema) {
                log('ERRO: Sistema n√£o carregado!', 'error');
                return;
            }
            
            if (typeof window.sistema.editarImovel !== 'function') {
                log('ERRO: Fun√ß√£o editarImovel n√£o existe!', 'error');
                return;
            }
            
            if (!window.sistema.imoveis || window.sistema.imoveis.length === 0) {
                log('ERRO: Nenhum im√≥vel dispon√≠vel!', 'error');
                return;
            }
            
            const primeiroImovel = window.sistema.imoveis[0];
            log(`Testando com im√≥vel ID: ${primeiroImovel.id} (${primeiroImovel.denominacao})`);
            
            try {
                window.sistema.editarImovel(primeiroImovel.id);
                log('Fun√ß√£o editarImovel() executada sem erros!', 'success');
                
                // Verificar se entrou em modo de edi√ß√£o
                setTimeout(() => {
                    if (window.sistema.imovelEditando) {
                        log(`Modo edi√ß√£o ativo: ID ${window.sistema.imovelEditando}`, 'success');
                    } else {
                        log('AVISO: Modo edi√ß√£o n√£o foi ativado', 'warning');
                    }
                    
                    // Verificar se formul√°rio foi preenchido
                    const codigo = document.getElementById('codigoEdificio');
                    if (codigo && codigo.value) {
                        log(`Formul√°rio preenchido com c√≥digo: ${codigo.value}`, 'success');
                    } else {
                        log('ERRO: Formul√°rio n√£o foi preenchido', 'error');
                    }
                }, 100);
                
            } catch (e) {
                log(`ERRO: ${e.message}`, 'error');
                console.error(e);
            }
        }

        function testarEditarImovelModal() {
            log('=== TESTANDO editarImovelModal() ===');
            
            if (!window.sistema) {
                log('ERRO: Sistema n√£o carregado!', 'error');
                return;
            }
            
            if (typeof window.sistema.editarImovelModal !== 'function') {
                log('ERRO: Fun√ß√£o editarImovelModal n√£o existe!', 'error');
                return;
            }
            
            // Primeiro simular que h√° um im√≥vel no modal
            if (window.sistema.imoveis && window.sistema.imoveis.length > 0) {
                window.sistema.imovelAtualModal = window.sistema.imoveis[0].id;
                log(`Simulando im√≥vel no modal: ID ${window.sistema.imovelAtualModal}`, 'warning');
            }
            
            try {
                window.sistema.editarImovelModal();
                log('Fun√ß√£o editarImovelModal() executada sem erros!', 'success');
                
                // Verificar resultados
                setTimeout(() => {
                    if (window.sistema.imovelEditando) {
                        log(`Modo edi√ß√£o ativo: ID ${window.sistema.imovelEditando}`, 'success');
                    } else {
                        log('AVISO: Modo edi√ß√£o n√£o foi ativado', 'warning');
                    }
                }, 100);
                
            } catch (e) {
                log(`ERRO: ${e.message}`, 'error');
                console.error(e);
            }
        }

        function verificarFormulario() {
            log('=== VERIFICANDO FORMUL√ÅRIO ===');
            
            const campos = [
                'codigoEdificio', 'denominacaoEdificio', 'localCidade', 
                'ruaEndereco', 'cepImovel', 'statusImovel',
                'inicioValidadeObj', 'objetoValidoAte', 'inscricaoIPTU', 'numeroITR'
            ];
            
            let camposEncontrados = 0;
            
            campos.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    camposEncontrados++;
                    log(`‚úì ${campo}: ${elemento.value || '(vazio)'}`, 'success');
                } else {
                    log(`‚úó ${campo}: ELEMENTO N√ÉO ENCONTRADO`, 'error');
                }
            });
            
            log(`Total: ${camposEncontrados}/${campos.length} campos encontrados`);
            
            // Verificar bot√£o
            const btnAdicionar = document.getElementById('adicionarImovel');
            if (btnAdicionar) {
                log(`‚úì Bot√£o "adicionarImovel": "${btnAdicionar.textContent}"`, 'success');
            } else {
                log('‚úó Bot√£o "adicionarImovel": N√ÉO ENCONTRADO', 'error');
            }
        }

        function verificarElementos() {
            log('=== VERIFICANDO ELEMENTOS DOM ===');
            
            // Verificar se sistema tem fun√ß√£o mostrarFormulario
            if (window.sistema && typeof window.sistema.mostrarFormulario === 'function') {
                log('‚úì Fun√ß√£o mostrarFormulario existe', 'success');
            } else {
                log('‚úó Fun√ß√£o mostrarFormulario N√ÉO EXISTE', 'error');
            }
            
            // Verificar se√ß√µes do DOM
            const secoes = ['secaoImoveis', 'secaoFormulario', 'secaoLocadores'];
            secoes.forEach(secao => {
                const elemento = document.getElementById(secao);
                if (elemento) {
                    log(`‚úì Se√ß√£o ${secao}: encontrada (display: ${getComputedStyle(elemento).display})`, 'success');
                } else {
                    log(`‚úó Se√ß√£o ${secao}: N√ÉO ENCONTRADA`, 'error');
                }
            });
            
            // Verificar modal
            const modal = document.getElementById('modalDetalhesImovel');
            if (modal) {
                log(`‚úì Modal detalhes: encontrado (display: ${modal.style.display})`, 'success');
            } else {
                log('‚úó Modal detalhes: N√ÉO ENCONTRADO', 'error');
            }
        }

        // Interceptar alertas para ver o que est√° acontecendo
        const originalAlert = window.alert;
        window.alert = function(message) {
            log(`üö® ALERT: ${message}`, 'warning');
            return originalAlert(message);
        };

        // Aguardar carregamento
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('P√°gina carregada. Iniciando diagn√≥stico...');
                if (window.sistema) {
                    log(`‚úì Sistema carregado: ${typeof window.sistema}`, 'success');
                    log(`‚úì Im√≥veis: ${window.sistema.imoveis ? window.sistema.imoveis.length : 'INDEFINIDO'}`, 'success');
                } else {
                    log('‚úó Sistema N√ÉO carregado', 'error');
                }
            }, 1000);
        });

        // Interceptar erros
        window.addEventListener('error', (event) => {
            log(`üí• ERRO JavaScript: ${event.message} em ${event.filename}:${event.lineno}`, 'error');
        });
    </script>
</body>
</html>
